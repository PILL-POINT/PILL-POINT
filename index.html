<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="shortcut icon" href="LOGO.png" type="image/x-icon">
  <title>PILL-POINT</title>

  <!-- CSS -->
  <link rel="stylesheet" href="assets/css/bootstrap.min.css" />
  <link rel="stylesheet" href="assets/css/lineicons.css" />
  <link rel="stylesheet" href="assets/css/materialdesignicons.min.css" />
  <link rel="stylesheet" href="assets/css/fullcalendar.css" />
  <link rel="stylesheet" href="assets/css/main.css" />
</head>
<body>
  <!-- Preloader -->
  <div id="preloader"><div class="spinner"></div></div>

  <main class="main-wrapper" style="margin:0;padding:0;width:100vw;max-width:100vw;overflow-x:hidden;">
    
    <!-- Header -->
    <header class="header">
      <div class="container-fluid d-flex align-items-center justify-content-between">
        <div class="d-flex align-items-center">
          <div class="logo-box me-3">
            <a href="inicio de revision2.html"><img src="logo.png" alt="Logo" class="logo-img" /></a>
          </div>
          <button class="menu-toggle d-md-none" onclick="toggleMenu()">☰</button>
          <nav id="responsiveMenu" class="nav-inline d-none d-md-flex">
            <a href="Inicio de sesion.html">Iniciar Sesión</a>
          </nav>
        </div>
        <div class="col-lg-7 col-md-7 col-6">
          <div class="header-right">
            <div class="profile-box ml-15">
              <button class="dropdown-toggle bg-transparent border-0" type="button" id="profile" data-bs-toggle="dropdown">
                <div class="profile-info"><div class="info"></div></div>
              </button>
            </div>
          </div>
        </div>
      </div>
    </header>

    <!-- Carrusel -->
    <style>
      #carouselFotos { max-width: 100%; margin: auto; }
      #carouselFotos img { max-height: 820px; object-fit: cover; width: 100%; }
    </style>
    <div id="carouselFotos" class="carousel slide mb-4" data-bs-ride="carousel">
      <div class="carousel-inner">
        <div class="carousel-item active"><img src="Foto3.png" class="d-block w-100" alt="Foto 1"></div>
        <div class="carousel-item"><img src="Foto4.png" class="d-block w-100" alt="Foto 2"></div>
      </div>
      <button class="carousel-control-prev" type="button" data-bs-target="#carouselFotos" data-bs-slide="prev">
        <span class="carousel-control-prev-icon"></span>
        <span class="visually-hidden">Anterior</span>
      </button>
      <button class="carousel-control-next" type="button" data-bs-target="#carouselFotos" data-bs-slide="next">
        <span class="carousel-control-next-icon"></span>
        <span class="visually-hidden">Siguiente</span>
      </button>
    </div>

    <!-- Icon Cards -->
    <div class="row text-center">
      <div class="col-xl-3 col-lg-4 col-sm-6">
        <div class="icon-card mb-30">
          <div class="icon success"><img src="registro.png" width="30" alt=""></div>
          <div class="content"><a href="registros.html"><h3 class="text-bold mb-10">Registro de medicamentos</h3></a></div>
        </div>
      </div>
      <div class="col-xl-3 col-lg-4 col-sm-6">
        <div class="icon-card mb-30">
          <div class="icon primary"><img src="historial.png" width="35" alt=""></div>
          <div class="content"><a href="historial.html"><h3 class="text-bold mb-10">Revisar Historial</h3></a></div>
        </div>
      </div>
      <div class="col-xl-3 col-lg-4 col-sm-6">
        <div class="icon-card mb-30">
          <div class="icon orange"><img src="dispositivo.png" width="30" alt=""></div>
          <div class="content"><a href="dispositivo.html"><h3 class="text-bold mb-10">Dispositivo</h3></a></div>
        </div>
      </div>
    </div>

    <!-- Calendario y tabla -->
    <div class="row">
      <div class="col-lg-5">
        <div class="card-style calendar-card mb-30">
          <div id="calendar-mini"></div>
        </div>
      </div>
      <div class="col-lg-7">
        <div class="card-style mb-30">
          <div class="title d-flex justify-content-between">
            <h6 class="text-medium mb-30">Tratamientos</h6>
          </div>
          <div class="table-responsive">
            <table class="table top-selling-table">
              <thead>
                <tr>
                  <th>Medicamento</th>
                  <th>Cantidad</th>
                  <th>Tipo</th>
                  <th>Hora</th>
                  <th>Estado</th>
                  <th class="text-end">Acciones</th>
                </tr>
              </thead>
              <tbody id="tratamientos-tabla"></tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

    <!-- Footer -->
    <footer class="footer mt-4">
      <div class="container-fluid">
        <div class="row">
          <div class="col-md-6 text-center text-md-end">
            <a href="terminos.html" class="text-sm">Términos y Condiciones</a>
            <a href="privacidad.html" class="text-sm ms-3">Política de Privacidad</a>
          </div>
        </div>
      </div>
    </footer>
  </main>

  <!-- JS -->
  <script src="assets/js/bootstrap.bundle.min.js"></script>
  <script src="assets/js/Chart.min.js"></script>
  <script src="assets/js/dynamic-pie-chart.js"></script>
  <script src="assets/js/moment.min.js"></script>
  <script src="assets/js/fullcalendar.js"></script>
  <script src="assets/js/jvectormap.min.js"></script>
  <script src="assets/js/world-merc.js"></script>
  <script src="assets/js/polyfill.js"></script>
  <script src="assets/js/main.js"></script>

  <!-- Script de tratamientos y calendario -->
  <script>
    document.addEventListener("DOMContentLoaded", function () {
      // Mini calendario
      var calendarMiniEl = document.getElementById("calendar-mini");
      var calendarMini = new FullCalendar.Calendar(calendarMiniEl, {
        locale: 'es',
        initialView: "dayGridMonth",
        headerToolbar: { end: "today prev,next" },
      });
      calendarMini.render();

      // Mostrar tratamientos en la tabla
      var tratamientos = [];
      try { tratamientos = JSON.parse(localStorage.getItem("tratamientos")) || []; }
      catch (e) { tratamientos = []; }

      var tabla = document.getElementById("tratamientos-tabla");
      tabla.innerHTML = "";
      if (tratamientos.length === 0) {
        tabla.innerHTML = '<tr><td colspan="6" class="text-center text-muted">No hay tratamientos registrados.</td></tr>';
      } else {
        tratamientos.forEach(function(t, idx) {
          var fila = document.createElement("tr");
          fila.innerHTML = `
            <td><p class='text-sm'>${t.nombre || "Sin nombre"}</p></td>
            <td><p class='text-sm'>${t.cantidad || "-"} ${t.unidad || ""}</p></td>
            <td><p class='text-sm'>${t.tipo || "-"}</p></td>
            <td><p class='text-sm'>${t.hora || "-"}</p></td>
            <td><span class='status-btn close-btn'>Pendiente</span></td>
            <td>
              <div class='action justify-content-end'>
                <button class='edit' data-idx='${idx}'><i class='lni lni-pencil'></i></button>
                <button class='more-btn ml-10 eliminar-tratamiento' data-idx='${idx}'><i class='lni lni-trash'></i></button>
              </div>
            </td>
          `;
          tabla.appendChild(fila);

          // Botón editar
          fila.querySelector('.edit').addEventListener('click', function() {
            window.location.href = `agenda.html?edit=${idx}`;
          });

          // Botón eliminar
          fila.querySelector('.eliminar-tratamiento').addEventListener('click', function() {
            if (confirm('¿Seguro que deseas eliminar este tratamiento?')) {
              tratamientos.splice(idx, 1);
              localStorage.setItem("tratamientos", JSON.stringify(tratamientos));
              fila.remove();
              if (tratamientos.length === 0) {
                tabla.innerHTML = '<tr><td colspan="6" class="text-center text-muted">No hay tratamientos registrados.</td></tr>';
              }
            }
          });
        });
      }
    });

    // Menú responsivo
    function toggleMenu() {
      const menu = document.getElementById('responsiveMenu');
      menu.classList.toggle('d-none');
      setTimeout(() => { menu.classList.toggle('show'); }, 10);
    }
    function closeMenu() {
      const menu = document.getElementById('responsiveMenu');
      menu.classList.remove('show');
      setTimeout(() => { menu.classList.add('d-none'); }, 300);
    }
    document.addEventListener('click', function (event) {
      const menu = document.getElementById('responsiveMenu');
      const toggle = document.querySelector('.menu-toggle');
      if (menu.classList.contains('show') && !menu.contains(event.target) && !toggle.contains(event.target)) {
        closeMenu();
      }
    });
  </script>

</body>
</html>
